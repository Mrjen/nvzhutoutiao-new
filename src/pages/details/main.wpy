<template>
  <view class="detail" >
        <!-- 话题主题 -->
      <view class="topic" id="topic">
        <view class="topic_top">
          <view class="topic_title">{{ArticleTtictle}}</view>
          <view class="author" @tap="goHomego">
              <text class="applet">萤火虫亮了</text>
              <text class="orgin_author">{{Article_author}}</text>
              <text class="create_time">{{Article_createtime}}</text>
          </view>

        <!-- 文章正文 -->
        <form bindsubmit="saveFormId" report-submit="true">
          <view class="content" @tap="inputBlur">
                  <rich-text class="richtext" nodes="{{ArticleContent}}"></rich-text>
          </view>
          
          <!-- 肌肤测试 -->
          <view class="articl-test" 
                wx:if="{{ArticleId=='1924'}}" 
                @tap="openSkinTest"></view>

          <navigator wx:if="{{is_story=='1'?true:false}}" 
                     url="/pages/subPackages02/pages/dayQuote/main" 
                     style="text-align:center;color:#647ffb;margin-bottom:50rpx" 
                     hover-class="none">>>每日物语海报下载</navigator>
        </form>

        <!-- 解忧栏 -->
          <view class="solve-problems" wx:if="{{is_letter}}">
              <button lang="zh_CN"
                      wx:if="{{is_accredit=='1'?false:true}}"
                      @getuserinfo="getUserInfo"
                      class="write-email"
                      open-type="getUserInfo">
                <view class="solve-btn"></view>
              </button>
              <button class="write-email" 
                      @tap="toWriteSolveProblems" 
                      wx:else><view class="solve-btn"></view></button>
          </view>

          <!-- 投票 -->
          <view class="vote" wx:if="{{voteList.length}}">
            <!-- 占位用的 -->
            <view class="zanwei">
              <view class="vote-item" 
                    wx:for="{{voteList}}" 
                    wx:key="{{index}}">
                     <view style="width:300rpx;height:300rpx;"></view>
                <!-- <view class="item {{item.active?'text-active':''}}">{{item.text}}</view> -->
              </view>
            </view>
            <!-- 投票内容 -->
            <view class="vote-in">
              <view class="vote_title">{{vote_title}}</view>
            <view class="info">
              <view class="player">
              参与人数：<text>{{vote_total}}</text>
              </view>    
              <view class="remain"><text>剩余天数：</text><view class="time">{{voteDeadLine}}</view></view>  
            </view>  
            <view class="vote-main vote-before" 
                  wx:if="{{vote_status=='0'?true:false}}">
              <view class="vote-item" 
                    wx:for="{{voteList}}" 
                    wx:key="{{index}}"
                    data-idx="{{index}}"
                    data-id="{{item.id}}"
                    @tap="changeVote">
                <view class="circle {{item.active?'circle-active':''}}"></view>
                <view class="item {{item.active?'text-active':''}}">{{item.votetitle}}</view>
              </view>
              <button class="vote-btn" 
                      @tap="VoteBtn">投一票</button>
            </view>    
            <view class="vote-main vote-after" wx:else>
              <view class="v-item" 
                     wx:for="{{voteList}}"
                     wx:key="{{index}}">
                <view class="v-title">{{item.votetitle}}{{item.is_select?'(已选)':''}}</view>
                <view class="v-vote-bar">
                  <view class="bar-in" 
                        style="width:{{(536/vote_total) * item.involveNum}}rpx;">{{item.involveNum}}票</view>
                  <text>{{item.percent+'%'}}</text>
                </view>
              </view>
              <button open-type="share" 
                      class="invate-btn" 
                      data-type="vote">召集小伙伴投票</button>
            </view>    
          </view>
        </view>
          <view class="article-info">
              <view class="info-item brower"><text>阅读</text>{{Article_readtimes}}</view>
              <view class="comment" 
                    wx:if="{{show_input_1}}">加入粉丝福利群<button open-type="contact">回复1进群</button></view>
          </view>
        </view>

      </view>
      <!-- 话题结束 -->

      <!-- 更多推荐 -->
        <view class="more-article">
           <view class="title">推荐话题</view>
           <navigator wx:for="{{recommendList}}" 
                      open-type="redirect" 
                      class="article-nav"
                      hover-class="none"
                      wx:key="{{index}}"
                      url="/pages/details/main?from=index&id={{item.id}}">{{item.title}}</navigator>
            <navigator class="back-home" @tap="ArticleBtnToHome" data-url="/pages/index/main" data-type="indextopic"><text>>>进入首页</text>查看更多话题</navigator>
        </view>

      <!-- 评论区 -->
      <view id="comm">
        <!-- 精彩评论 -->
        <view class="comments" wx:if="{{topComment.length>0&&showNewComm?true:false}}">
          <view class="wonderfulComments">
            <text>{{commTitle}}</text>
            <view wx:if="{{topComment.length>0?true:false}}" 
                  class="wrtie-comment">
                <view wx:for="{{commListNav}}" 
                      wx:key="{{index}}"
                      data-type="{{item.type}}"
                      data-idx="{{index}}"
                      class="ls-item {{item.active?'ls-active':''}}" 
                      @tap="changeCommSort">{{item.text}}</view>
            </view>
          </view>

          <view wx:for="{{topComment}}" 
                wx:for-index="cidx"
                wx:for-item="comm"
                wx:key="{{comm.id}}"
                class="commentsConter {{toView===('cc'+comm.id)?'active_comment':''}}" 
                id="cc{{comm.id}}">
            <view class="space_b" 
                  style="align-items:flex-start;display:flex">
              <view class="comm_main">
                <view class="avatar">
                   <image src="{{comm.avatarUrl}}" 
                        class="head_img" 
                        style="border-radius:50%;overflow:hidden"
                        @tap="toUserCenter({{comm.user_id}}, {{comm.is_self}})"/>
                    <view class="head-reward" 
                          data-uid="{{comm.user_id}}"
                          data-comid="{{comm.id}}"
                          @tap="RewardBtn">赏</view>
                </view>
                <view>
                  <view class="display_flex flex_warp">
                    <view class="comment_name">{{comm.nickName}}<text style="color:red">{{comm.friend?'('+comm.friend+')':''}}</text></view>
                    <image wx:if="{{comm.gender==='1'}}" src="../image/boy.png" class="gender" />
                    <image wx:if="{{comm.gender==='2'}}" src="../image/girl.png" class="gender" />
                    <view class="lv-icon">
                        <image wx:for="{{comm.icon_url_arr}}" 
                               wx:for-item="icon" 
                               wx:key="{{index}}" 
                               src="{{icon}}"/>
                    </view>
                  </view>

                  <view class="floor display_flex">
                    <view>{{comm.create_time}}</view>
                    <view class="verticalBar"></view>
                    <view>{{comm.floor}}楼</view>
                  </view>

                </view>
              </view>
              <view class="display_flex comm_comment">
                <view class="nice {{comm.likestatus=='1'?'active_text':''}}">
                  <!-- 未授权 -->
                  <button class="get_user_info zan_get_info" 
                          lang="zh_CN"  
                          open-type="getUserInfo" 
                          @getuserinfo="getUserInfo"
                          wx:if="{{is_accredit=='1'?false:true}}"></button>
                   
                  <view class="niceImg"  
                        @tap="likeCommentZan({{cidx}}, {{comm.id}}, {{comm.likestatus}}, '精彩评论点亮')"
                        wx:elif="{{comm.likestatus=='0'?true:false}}"></view>
                  
                  <view class="active_nice" 
                        @tap="likeCommentZan({{cidx}}, {{comm.id}}, {{comm.likestatus}}, '精彩评论点亮')"
                        wx:elif="{{comm.likestatus=='1'?true:false}}"
                        ></view>
                        <text class="like_times">{{comm.liketimes}}</text>
                </view>

                <block>
                    <button class="same-comm" 
                            wx:if="{{is_accredit=='0'?true:false}}" 
                            lang="zh_CN"  
                            open-type="getUserInfo" 
                            @getuserinfo="getUserInfo">
                    </button>
                    <view class="same-comm" 
                        wx:else 
                        @tap="followCommentComment({{comm.id}}, {{cidx}}, {{comm.user_id}},'精彩评论一级', {{comm.nickName}}, {{comm.comment}})"></view>
              </block>

              </view>
            </view>
            
            <block>
              <button class="commentsTxt" 
                      open-type="getUserInfo" 
                      @getuserinfo="getUserInfo" 
                      lang="zh_CN"
                      wx:if="{{is_accredit=='0'?true:false}}">{{comm.comment}}</button>
              <view class="commentsTxt" 
                    wx:else 
                    @tap="followCommentComment({{comm.id}}, {{cidx}}, {{comm.user_id}}, '最新评论一级', {{comm.nickName}}, {{comm.comment}})">{{comm.comment}}</view>
              <view class="comm-image">
                 <view class="c-image" 
                       wx:for="{{comm.image}}" 
                       wx:key="{{index}}" 
                       wx:for-item="cimage"
                       wx:for-index="cimdx">
                   <image src="{{cimage}}" 
                          @tap="prevImage" 
                          mode="aspectFill"
                          data-idx="{{cimdx}}"
                          data-arr="{{comm.image}}"/>
                 </view>
              </view>
            </block>
            
            <view class="com_comments" 
                  wx:if="{{comm.follow_comment.length>0}}">
              <view class="font_24 border_bottom last-noborder" 
                    wx:for="{{comm.follow_comment}}" 
                    wx:for-item="follow"
                    wx:for-index="fidx"
                    wx:key="{{follow.floor}}">

                <view class="user-info">
                  <view class="info-left">
                    <image class="info-avatar" 
                           src="{{follow.avatarUrl}}" 
                           @tap="toUserCenter({{follow.user_id}}, {{follow.is_self}})"/>
                    <view class="info-info">
                      <view class="info-name">{{follow.nickName}}</view>
                      <view class="info-time">{{follow.create_time}}</view>
                    </view>
                  </view>

                  <view class="info-comm-btn">
                    <view class="zan {{follow.likestatus=='1'?'active_text':''}}">
                      <!-- 未授权 -->
                      <button class="get_user_info zan_get_info" 
                            lang="zh_CN" 
                            open-type="getUserInfo" 
                            @getuserinfo="getUserInfo"
                            wx:if="{{is_accredit=='0'?true:false}}"></button>
                            
                      <view class="niceImg"
                            wx:elif="{{follow.likestatus=='0'}}"
                            @tap="addFollowZan({{follow.likestatus}}, {{follow.follow_comment_id}}, {{fidx}}, {{cidx}}, '精彩评论')"></view>

                      <view class="active_nice"
                            wx:elif="{{follow.likestatus=='1'}}"
                            @tap="addFollowZan({{follow.likestatus}}, {{follow.follow_comment_id}}, {{fidx}}, {{cidx}}, '精彩评论')"></view>{{follow.liketimes}}
                    </view>

                    <view class="info-comm-cion">
                      <button class="same-comm" 
                              wx:if="{{is_accredit=='0'?true:false}}" 
                              lang="zh_CN" 
                              open-type="getUserInfo" 
                              @getuserinfo="getUserInfo">
                      </button>
                      <view class="same-comm" 
                            wx:else 
                            @tap="followFollowComment({{follow.user_id}}, {{comm.id}}, {{fidx}}, {{cidx}}, '精彩评论二级', {{follow.nickName}},{{follow.follow_comment}})"></view>
                    </view>

                  </view>
                </view>

              <block>
              <button class="talker" 
                      open-type="getUserInfo"  
                      lang="zh_CN" 
                      @getuserinfo="getUserInfo" 
                      wx:if="{{is_accredit=='0'?true:false}}">
                    <text>@{{follow.renickName}}：</text>{{follow.follow_comment}}
              </button>

                <view class="talker" 
                      wx:else>回复
                      <text>@{{follow.renickName}}：</text>
                      <text @tap="followFollowComment({{follow.user_id}}, {{comm.id}}, {{fidx}}, {{cidx}}, '精彩评论二级', {{follow.nickName}},{{follow.follow_comment}})"  style="color:#333">{{follow.follow_comment}}</text>
                      <view class="f-image">
                         <view class="f-img" 
                               wx:for="{{follow.image}}" 
                               wx:key="{{index}}"
                               wx:for-item="simage">
                           <image src="{{simage}}" 
                                  mode="widthFix" 
                                  data-arr="{{follow.image}}"
                                  data-idx="{{fidx}}"
                                  @tap="prevImage"/>
                         </view>
                      </view>
                </view>
                </block>

              </view>
              <view class="otherAnswer" 
                    wx:if="{{comm.is_page}}" 
                    @tap="readMoreFollowComm({{comm.id}}, {{cidx}}, '点击精彩评论查看更多')">查看更多评论</view>
              <view class="otherAnswer" 
                    wx:if="{{!comm.is_page&&comm.follow_comment.length>2}}" 
                    @tap="collapseComment({{cidx}},'收起精彩评论')">收起评论</view>
            </view>
          </view>
        </view>

        <!-- 最新评论 -->
        <view class="comments" 
              wx:if="{{comment.length>0?true:false}}">
          <view class="wonderfulComments">
            <text>{{commTitle==='热门评论'?'最新评论':commTitle}}</text>
            <!-- wx:if="{{topComment.length>0?false:true}}" -->
            <view wx:if="{{showNewComm===true&&topComment!=0?false:true}}"
                  class="wrtie-comment">
              <view wx:for="{{commListNav}}" 
                      wx:key="{{index}}"
                      data-type="{{item.type}}"
                      data-idx="{{index}}"
                      class="ls-item {{item.active?'ls-active':''}}" 
                      @tap="changeCommSort">{{item.text}}</view>
            </view>
          </view>
           
          <view wx:for="{{comment}}"
                wx:for-item="comm"
                wx:for-index="cidx"
                wx:key="{{comm.id}}"
                class="commentsConter {{toView===('cc'+comm.id)?'active_comment':''}}" 
                id="cc{{comm.id}}">
            <view class="space_b" 
                  style="align-items:flex-start;display:flex">
              <view class="comm_main">
                <view class="avatar">
                   <image src="{{comm.avatarUrl}}" 
                        class="head_img" 
                        style="border-radius:50%;overflow:hidden"
                        @tap="toUserCenter({{comm.user_id}}, {{comm.is_self}})"/>
                    <view class="head-reward" 
                          data-uid="{{comm.user_id}}"
                          data-comid="{{comm.id}}"
                          @tap="RewardBtn">赏</view>
                </view>
                <view>
                  <view class="display_flex flex_wrap">

                    <view class="comment_name">{{comm.nickName}}<text style="color:red">{{comm.friend?'('+comm.friend+')':''}}</text></view>
                    <image wx:if="{{comm.gender==='1'}}" 
                           src="../image/boy.png" 
                           class="gender" />
                    <image wx:if="{{comm.gender==='2'}}" 
                           src="../image/girl.png" 
                           class="gender"/>
                    <view class="lv-icon">
                        <image wx:for="{{comm.icon_url_arr}}" 
                               wx:for-item="icon" 
                               wx:key="{{index}}" 
                               src="{{icon}}"/>
                    </view>
                  </view>
                  <view class="floor display_flex">
                    <view>{{comm.create_time}}</view>
                    <view class="verticalBar"></view>
                    <view>{{comm.floor}}楼</view>
                  </view>
                </view>
              </view>
              <view class="display_flex comm_comment">
                <view class="nice {{comm.likestatus=='1'?'active_text':''}}">
                   <!-- 未授权 -->
                    <button class="get_user_info zan_get_info" 
                            lang="zh_CN" 
                            open-type="getUserInfo" 
                            @getuserinfo="getUserInfo"
                            wx:if="{{is_accredit=='1'?false:true}}"></button>
                  
                  <view class="niceImg" 
                        wx:elif="{{comm.likestatus=='0'?true:false}}" 
                        @tap="likeCommentZan({{cidx}}, {{comm.id}}, {{comm.likestatus}}, '最新评论点亮')" ></view>
                  <view class="active_nice" 
                        wx:elif="{{comm.likestatus=='1'?true:false}}"
                        @tap="likeCommentZan({{cidx}}, {{comm.id}}, {{comm.likestatus}},'最新评论点亮')"></view>
                        <text class="like_times">{{comm.liketimes}}</text>
                </view>

                <block>
                    <button class="same-comm" 
                            wx:if="{{is_accredit=='0'?true:false}}" 
                            lang="zh_CN"  
                            open-type="getUserInfo" 
                            @getuserinfo="getUserInfo">
                    </button>
                    <view wx:else 
                          class="same-comm" 
                          @tap="followCommentComment({{comm.id}}, {{cidx}}, {{comm.user_id}},'最新评论一级', {{comm.nickName}}, {{comm.comment}})"></view>
              </block>

              </view>
            </view>
            <block>
              <button class="commentsTxt" open-type="getUserInfo" 
                      @getuserinfo="getUserInfo" 
                      lang="zh_CN"
                      wx:if="{{is_accredit=='0'?true:false}}">{{comm.comment}}</button>
              <view class="commentsTxt" 
                    wx:else  
                    @tap="followCommentComment({{comm.id}}, {{cidx}}, {{comm.user_id}}, '最新评论一级', {{comm.nickName}}, {{comm.comment}})">{{comm.comment}}</view>
              <view class="comm-image">
                 <view class="c-image" 
                       wx:for="{{comm.image}}" 
                       wx:key="{{index}}" 
                       wx:for-item="cimage"
                       wx:for-index="cimdx">
                   <image src="{{cimage}}" 
                          mode="aspectFill" 
                          @tap="prevImage" 
                          data-idx="{{cimdx}}"
                          data-arr="{{comm.image}}"/>
                 </view>
              </view>
            </block>


            <view class="com_comments" 
                  wx:if="{{comm.follow_comment.length>0}}">
                  <!-- v-for="(follow, fidx) in comm.follow_comment" -->
              <view class="font_24 border_bottom last-noborder" 
                    wx:for="{{comm.follow_comment}}"
                    wx:for-item="follow"
                    wx:for-index="fidx"
                    wx:key="{{follow.floor}}">
                <view class="user-info">
                  <view class="info-left">
                    <image class="info-avatar" 
                           src="{{follow.avatarUrl}}"  
                           @tap="toUserCenter({{follow.user_id}},{{follow.is_self}})" />
                    <view class="info-info">
                      <view class="info-name">{{follow.nickName}}</view>
                      <view class="info-time">{{follow.create_time}}</view>
                    </view>
                  </view>
                  <view class="info-comm-btn">
                    <view class="zan">
                      <!-- 未授权 -->
                      <button class="get_user_info zan_get_info" 
                            lang="zh_CN" 
                            open-type="getUserInfo" 
                            @getuserinfo="getUserInfo"
                            wx:if="{{is_accredit=='0'?true:false}}"></button>
                      <view class="niceImg" 
                            wx:elif="{{follow.likestatus=='0'}}" 
                            @tap="addFollowZan({{follow.likestatus}}, {{follow.follow_comment_id}}, {{fidx}}, {{cidx}}, '最新评论',{{follow.nickName}})"></view>
                      <view class="active_nice" 
                            wx:elif="{{follow.likestatus=='1'}}" 
                            @tap="addFollowZan({{follow.likestatus}}, {{follow.follow_comment_id}}, {{fidx}}, {{cidx}}, '最新评论',{{follow.nickName}})"></view>{{follow.liketimes}}
                    </view>

                    <view class="info-comm-cion">
                        <button class="same-comm" 
                                wx:if="{{is_accredit=='0'?true:false}}"  
                                lang="zh_CN" 
                                open-type="getUserInfo" 
                                @getuserinfo="getUserInfo">
                        </button>
                        <view class="same-comm" 
                              wx:else 
                              @tap="followFollowComment({{follow.user_id}}, {{comm.id}}, {{fidx}}, {{cidx}}, '最新评论二级', {{follow.nickName}},{{follow.follow_comment}})"></view>
                    </view>

                  </view>
                </view>

                <block>
                    <button class="talker" 
                            open-type="getUserInfo"  
                            lang="zh_CN" 
                            @getuserinfo="getUserInfo" 
                            wx:if="{{is_accredit=='0'?true:false}}">
                        <text>@{{follow.renickName}}：</text>{{follow.follow_comment}}
                    </button>
                    <view class="talker"
                        wx:else>回复
                        <text>@{{follow.renickName}}：</text>
                        <text @tap="followFollowComment({{follow.user_id}}, {{comm.id}}, {{fidx}}, {{cidx}}, '最新评论二级', {{follow.nickName}},{{follow.follow_comment}})" style="color:#333">{{follow.follow_comment}}</text>
                          <view class="f-image">
                              <view class="f-img" 
                                    wx:for="{{follow.image}}" 
                                    wx:key="{{index}}"
                                    wx:for-index="fidx"
                                    wx:for-item="simage">
                                <image src="{{simage}}" 
                                        mode="widthFix" 
                                        data-arr="{{follow.image}}"
                                        data-idx="{{fidx}}"
                                        @tap="prevImage"/>
                              </view>
                          </view>
                    </view>
              </block>

              </view>

              <view class="otherAnswer" wx:if="{{comm.is_page}}" 
                    @tap="readMoreFollowComm({{comm.id}}, {{cidx}}, '点击最新评论查看更多')">查看更多评论</view>
              <view class="otherAnswer" 
                    wx:if="{{!comm.is_page&&comm.follow_comment.length>2}}" 
                    @tap="collapseComment({{cidx}},'收起最新评论')">收起评论</view>
            </view>
          </view>
        </view>

        <!-- 没有评论 -->
        <view class="no-comment" wx:if="{{((!comment.length)&&(!topComment.length))?true:false}}">
            <image src="https://gcdn.playonwechat.com/nvzhu/msg_1.png" alt=""/>
            <view>还没有人发言，快来抢沙发~</view>
        </view>
      </view>
      <!-- 评论结束 -->

   <block>

    <view class="botm-bar" wx:if="{{show_input_1}}">
      <block>
        <view class="is_userinfo">
          <button class="btn-input" 
                  wx:if="{{is_accredit=='1'}}" 
                  @tap="writeComment">评论有赏...</button>
          <button class="btn-input no_userinfo" 
                  wx:else 
                  open-type="getUserInfo" 
                  lang="zh_CN" 
                  @getuserinfo="getUserInfo">评论有赏....</button>
        </view>
      </block>

      <view class="input-op">
        <view class="a-op">
           <view class="a-icon like {{Article_likestatus=='1'?'like-active':''}}" 
                 @tap="likeArticle"></view>
           <view class="num">{{Article_liketimes}}</view>
        </view>
        <view class="a-op">
           <view class="a-icon comm" @tap="toComment"></view>
           <view class="num">{{Article_comments}}</view>
        </view>
        <view class="a-op" @tap="shareOpation">
           <view class="a-icon share"></view>
           <view class="num">{{Article_sharetimes}}</view>
        </view>
      </view>
    </view>
</block>

  <!-- loading -->
  <!-- <view class="loading" wx:if="{{pageLoad}}">
      <image mode="widthFix" style="width:100rpx;height:100rpx" src="https://gcdn.playonwechat.com/nvzhu/Spinner-1s-100px.gif"/>
  </view> -->


  <form bindsubmit="goHomego" report-submit="true">
    <button formType="submit" class="home-icon"></button>
  </form>

<view class="zhanwei" style="width:500rpx;height:150rpx;"></view>

  <!-- toast -->
  <myToast :title.sync="toastTitle" 
           :jifen.sync="toastJiFen" 
           :Experence.sync="toastJingyan" 
           :toastShow.sync="toastShow"></myToast>

  <!-- 分享和下载海报弹层 -->
  <block wx:if="{{actionSheetHidden?false:true}}">
    <action-sheet hidden="{{actionSheetHidden}}" 
                  catchchange="shareOpation">
          <button open-type="share" 
                  data-name="item" 
                  class="action-item action-item0">发给朋友</button>
          <button @tap="downloadPoster" 
                  data-name="item" 
                  class="action-item action-item1">生成图片分享朋友</button>
      <!--自动隐藏action-sheet-->
      <action-sheet-cancel>取消
        <view style="width:750rpx;height:40rpx;background:#fff"></view>
        </action-sheet-cancel>
    </action-sheet>
  </block>

  <!-- 打赏弹层 -->
  <RewardPoup :showReward.sync="showReward" 
              :moneyList.sync="moneyList"
              :EditMoney.sync="EditMoney"
              @RewardBtn.user="RewardBtn" 
              @inputMoney.user="inputMoney"
              @TapEditMoney.user="TapEditMoney"
              @payMoney.user="payMoney"
              @changeRewardMoney.user="changeRewardMoney"></RewardPoup>

<!-- 页面 点击肌肤测试 -->
  <view wx:if="{{ArticleId=='1924'}}" 
        class="click-test {{clickBtnShow?'click-show':'click-hide'}}" 
        @tap="openSkinTest"></view>

</view>
</template>

<script>
import wepy from 'wepy';
import wxRequest from '../../utils/http.js';
import api from '../../utils/api.js';

import tips from '../../utils/tips.js';
import sharPop from '../../components/shareItem';
import utils from '../../utils/utils';
import myToast from '../../components/myToast';
import qiniuUploader from '../../utils/qiniuUploader';
import RewardPoup from '../../components/rewardPopup';
export default class Detail extends wepy.page {
  config = {
    navigationBarTitleText: '话题详情'
  };
  data = {
    clickBtnShow: false,          // 是否显示点击测试按钮
    name: 'myHtmlParserKiner1',
    ArticleContent: '',            // 文章内容
    topComment: '',                // 热门评论
    detail: {},                    // 详情数据
    comment: [],                   // 最新评论内容
    inputFcus: false,              // 输入框焦点
    commContent: '',               // 评论内容
    commTitle: '热门评论',          // 评论bar的标题
    
    inputCursor: -1,               // 输入框光标位置
    inputValue: '',                // 输入框的值
    id: '',                        // 评论id
    commentDom: 'article',         // 评论对象 article follow
    page: 2,                       // 最新评论页数
    commentIdx: '',                // 一级评论index
    follow_page: 1,                // 跟评列表page
    follow_index: null,            // 跟评的index
    follow_id: null,
    user_id: null,                 // user_id
    comment_id: null,              // 评论id
    comment_type: null,            // 评论类型  -> 最新评论 \ 精彩评论
    inputPlaceholder: '发表你的观点',
    currentRewardCommId: null,     // 当前打赏评论id
    Article_likestatus: '',        // 文章点亮状态
    Article_liketimes: '',         // 文章喜欢次数
    Article_readtimes: 0,          // 文章阅读次数
    Article_createtime: '',        // 文章发布时间
    Article_sharetimes: 0,         // 文章分享次数
    Article_author: '',            // 文章作者
    Article_cover: null,           // 文章封面
    Article_comments: 0,           // 文章被评论次数
    ArticleTtictle: '',            // 文章标题
    ArticleId: '',                 // 文章id
    nickName: '',                  // 用户名字
    is_accredit: null,             // 是否授权
    userInfo: {},                  // 用户信息
    inputShow: false,              // 输入框是否显示
    shareQrcode: null,             // 分享二维码
    requestOver: true,             // 防止重复提交
    pageLoad: true,                // 当前页面加载完成
    article_Show_type: '',         // 文章显示类型，'wxparse' 'rich_text'
    comment_view: false,           // 是否显示文章评论
    systemInfo: '',                // 兼容iphone X

    // myToast
    toastTitle: '',                // toast标题
    toastJiFen: '',                // 积分
    toastJingyan: '',              // 经验
    toastShow: false,              // 是否显示

    // 投票
    vote_status: 0,                // 我是否已投票
    voteList: [],                  // 投票选项列表
    vote_total: '',                // 投票的总数
    currentVoteId: '',             // 当前选择的投票的id
    voteDeadLine: '',              // 投票截止日期
    vote_title: '',                // 投票标题
    vote_poster: '',               // 投票分享海报

    actionSheetHidden: true,       // actionSheet
    actionSheetItems: ['发给朋友', '生成图片分享朋友圈'],

    // scroll-view
    toView: '',                    // 滚动到页面元素的id

    // 定时器
    timer: null,
    is_announce: 0,                 // 评论是否允许发送图片

    tapCount: 1,
    tapStartTime: '',               // 双击屏幕开始时间
    tapEndTime: '',                 // 双击屏幕开始时间

    commListNav:[{
      id: 1,
      text: '默认',
      type: 'default',
      active: true
    },{
      id: 2,
      text: '最新',
      type: 'new',
      active: false
    },{
      id: 3,
      text: '最热',
      type: 'hot',
      active: false
    }],
    showNewComm: true,                // 是否显示
    showCommType: 'default',          // 默认显示的评论内容
    is_story: null,                   // 文章类型 是否是每日物语
    showReward: false,                // 是否显示打赏弹层  
    RewardUserId: null,
    EditMoney: true,                  // 默认显示已有金额， false显示输入框
    currentRewardMoney: null,         // 打赏金额
    recommendList: [],                // 更多推荐
                                      // 打赏数组
    moneyList:[{
        money: '0.16',
        id: 1,
        active: false
      },{
        money: '0.66',
        id: 2,
        active: false
      },{
        money: '1.68',
        id: 3,
        active: false
      },{
        money: '2.88',
        id: 4,
        active: false
      },{
        money: '5.20',
        id: 5,
        active: false
      },{
        money: '8.88',
        id: 6,
        active: false
      }],   
    fromPage: '',                        // 来自页面
    show_input_1: 0,                     // 是否显示入群
    is_letter: 0                         // 文章类型是解忧

  };

  components = {
    myToast: myToast,
    RewardPoup:RewardPoup
  };

  async onLoad(options) {
    let that = this;
    this.fromPage = options.from;
    this.$apply();
    setTimeout(() => {
      that.pageLoad = false;
      that.$apply();
    }, 300);

    if(options.from==='news'){
      wx.setNavigationBarTitle({title: '文章详情'})
    }

    console.log('页面数据', options);
    let _article_id = null;
    let share_user_id = null;
    let reid = null;
    if (options.id) {
      _article_id = options.id;
      wx.setStorage({ key: 'article_id', data: options.id });
      wx.setStorageSync('showCommIndex', 0);
    } else if (options.scene) {
      let scene = decodeURIComponent(options.scene);
      _article_id = utils.getQueryString('id', scene);
      share_user_id = utils.getQueryString('share_user_id', scene);
      wx.setStorage({ key: 'share_user_id', data: share_user_id });
      wx.setStorageSync('showCommIndex', 0);
      this.fromPage = utils.getQueryString('from', scene);
      this.$apply();
      console.log('_article_id', _article_id, 'share_user_id', share_user_id);
    }
    // 保证获取到token,如果从首页来不用重新请求token
      let token ='';
    if (!wx.getStorageSync('token')) {
       token = await utils.getToken();
       console.log('token', token)
    }

    // 获取详情页数据
    let data = {
      id: _article_id,
      page: 1,
      token:wx.getStorageSync('token')||token.data.data.token
    }

    if(options.reid){
      console.log('滚动到评论')
      reid = options.reid;
      data.reid = options.reid;
      this.toView = `cc${options.reid}`;
      this.$apply();
      setTimeout(async ()=>{
        let position = await utils.getElementRact(`cc${options.reid}`);
        wx.pageScrollTo({
          scrollTop: position[0].top,
          duration: 500
        })
        that.$apply();
      },500)
    }
    
    // 判断是否有user_id
    if(options.share_user_id){
      data.user_id = options.share_user_id
    }

    const detail = await wxRequest(api.getArticleDetail,data);

    // 这里数据字节过大，把数据拆分分次传递
    let _page_data = detail.data.data;
    this.is_story = _page_data.is_story;
    this.show_input_1 = _page_data.show_input_1;
    let voteList = _page_data.votedata;
    if(voteList){
      // 是否存在投票
      voteList.map(el=>{
        el.active = false;
        el.percent = (el.involveNum/_page_data.vote_total_num*100).toFixed(0); 
      })
      this.voteList = voteList;
      this.vote_total = _page_data.vote_total_num;
      this.vote_status = _page_data.vote_status;
      this.vote_title = _page_data.vote_title;
    }
    this.id = _article_id;
    this.ArticleId = _article_id;

    this.ArticleContent = _page_data.content.replace(/&nbsp;/g,'\xa0')

    _page_data.comment = utils.commentUnique(_page_data.comment);
    _page_data.topcomment = utils.commentUnique(_page_data.topcomment);

    // 把评论保存至缓存
    wx.setStorage({key: 'topComment', data:_page_data.topcomment});
    wx.setStorage({key: 'comment', data:_page_data.comment})
    
    this.topComment = _page_data.topcomment;
    this.comment = _page_data.comment;
    this.Article_liketimes = _page_data.liketimes;
    this.ArticleTtictle = _page_data.title;
    this.Article_readtimes = _page_data.readtimes;
    this.Article_createtime = _page_data.create_time;
    this.Article_sharetimes = _page_data.sharetimes;
    this.Article_comments = _page_data.commenttimes;
    this.Article_likestatus = _page_data.likestatus;
    this.article_Show_type = _page_data.article_type;
    this.comment_view = _page_data.comment_view;
    this.is_announce = _page_data.is_announce;
    this.is_letter = _page_data.is_letter;
    this.Article_author = _page_data.author;
    this.recommendList = _page_data.recommendList;

    this.systemInfo = wx.getStorageSync('systemInfo');
    this.$apply();

    // 投票剩余时间计算
    let voteDeadLine = _page_data.deadline*1000;
    console.log('voteDeadLine', voteDeadLine)
    if(this.timer){clearTimeout(this.timer)}   // 防止出现多定时器
    this.timer = setTimeout(function voteTime() { 
      if(Date.parse(new Date())<voteDeadLine){
         that.voteDeadLine = utils.formatRemainTime(voteDeadLine);
         that.$apply();
      }else{
        // console.log('Date.parse(new Date()',Date.parse(new Date()),voteDeadLine)
         that.voteDeadLine = '活动已结束';
         that.vote_status = 1;
         that.$apply();
         clearTimeout(that.timer)
      }
      that.timer = setTimeout(voteTime, 1000)
    }, 1000)

    // 检查用户是否是从别的用户分享而来
    if (options.share_user_id||share_user_id){
        console.log('此用户从别人分享进入小程序');
        wxRequest(api.getintegralshare,{share_user_id:share_user_id||options.share_user_id},'POST')
    }

    // 下载文章分享海报
    wx.downloadFile({
      url: _page_data.sharcover,
      success(res) {
        that.Article_cover = res.tempFilePath;
        that.$apply();
      }
    });
    this.$apply();

    // 保存默认评论列表选项
    wx.setStorage({key: 'showCommType', data: 'default'});
    
    // 下载投票分享海报
    if(voteList){
      console.log('文章存在投票')
      let p_vote = await wxRequest(api.voteposter,{article_id: this.ArticleId },'POST')
      console.log('p_vote', p_vote)
      if(p_vote.data.code===api.STATUS){
        let url = p_vote.data.data;
        wx.downloadFile({
          url:url,
          success(res){
             that.vote_poster = res.tempFilePath;
             that.$apply();
          }
        })
      }
    }
  }

  async onShow() {
    let that = this;
    if (this.id === wx.getStorageSync('article_id')) {
      console.log('相等');
    }
    this.commentDom = 'article';
    let token = '';
    if(!wx.getStorageSync('token')){
       token = await utils.getToken();
    }

    let userInfo = await wxRequest(api.getUserInfo, {token:wx.getStorageSync('token')||token.data.data.token}, 'POST');
    console.log('user', userInfo);
    if (userInfo.data.code === api.STATUS) {
      // this.is_accredit = 0;
      this.is_accredit = userInfo.data.data.is_accredit;
      this.nickName = userInfo.data.data.nickName;
      wx.setStorage({
        key: 'is_accredit',
        data: userInfo.data.data.is_accredit
      });
    }
    this.$apply();


    // 计算票
    let voteList = this.voteList;
    let vote_total_num = this.vote_total;
    if(voteList.length>0){
      voteList.map(el=>{
        el.active = false;
        el.percent = (el.involveNum/vote_total_num*100).toFixed(0); 
      })
      this.voteList = voteList;
      this.$apply();
    }

    // 更新评论
    let tab = wx.getStorageSync('showCommType');
    let comment = wx.getStorageSync('comment');
    let topComment = wx.getStorageSync('topComment');
    if(comment)  this.comment = comment;
    if(topComment) this.topComment = topComment;
    this.$apply();

    let cidx = wx.getStorageSync('showCommIndex') || 0;
    console.log('cidx', wx.getStorageSync('showCommIndex'))
    if(cidx>-1){
      setTimeout(()=>{
        console.log('当前的cidx',cidx)
        let commListNav = that.commListNav;
        commListNav.map(el=>{
          el.active = false;
        })
        commListNav[cidx].active = true;
        that.commListNav = commListNav;
        that.$apply();
      },100)  
    }
    

    // 检查评论是否有积分和经验
    let showMyToast = wx.getStorageSync('showMyToast');
    if(showMyToast=='1') {
      let myToast = wx.getStorageSync('myToast');
        wx.setStorage({key: 'showMyToast', data: '0'})
        this.toastTitle = '评论奖励';
        this.toastJiFen = myToast.toastJiFen;
        this.toastJingyan = myToast.toastJingyan;
        this.toastShow = true;
        setTimeout(() => {
          that.toastShow = false;
          that.$apply();
        }, 2000);
        this.$apply();
    }
    
  }

  onUnload() {
    console.log('隐藏了');
    this.inputFcus = false;
    this.ArticleContent = '';
    this.inputPlaceholder = '发表你的观点';
    clearTimeout(this.timer);
    wx.setStorage({key:'topComment', data: this.topComment});
    this.$apply();
  }

  async onPullDownRefresh() {
    console.log('刷新页面');
    this.inputFcus = false;
    console.log('this.inputFcus', this.inputFcus);
    const detail = await wxRequest(api.getArticleDetail, {
      id: this.ArticleId,
      page: 1
    });
    let _page_data = detail.data.data;
    let voteList = _page_data.votedata;
    voteList.map(el=>{
      el.active = false;
      el.percent = (el.involveNum/_page_data.vote_total_num*100).toFixed(0);
    })
    this.voteList = voteList;
    this.vote_total = _page_data.vote_total_num;
    this.vote_status = _page_data.vote_status;
    this.ArticleContent = _page_data.content;
    this.topComment = _page_data.topcomment;
    this.comment = _page_data.comment;
    this.Article_liketimes = _page_data.liketimes;
    this.ArticleTtictle = _page_data.title;
    this.Article_readtimes = _page_data.readtimes;
    this.Article_createtime = _page_data.create_time;
    this.Article_sharetimes = _page_data.sharetimes;
    this.Article_comments = _page_data.commenttimes;
    this.Article_likestatus = _page_data.likestatus;
    this.comment_view = _page_data.comment_view;
    this.is_letter = _page_data.is_letter;
    this.Article_author = _page_data.author;
    this.recommendList = _page_data.recommendList;
    this.page = 2;
    this.$apply();
    wx.stopPullDownRefresh();
    //  tips.success('刷新成功')

  }

  onShareAppMessage(e) {
    console.log('share', e);
    let that = this;
    let imageUrl ='';
    let title = '';
    let nickName = this.nickName || '我';
    let article_id = this.ArticleId;
    let fromPage = this.fromPage;
    
    if(fromPage==='news'&&e.from==='menu'){
      //  资讯分享
       title = `${nickName}分享一篇好文给你！`;
       imageUrl = that.Article_cover;


    }else if(fromPage==='news'&&e.from==='button'){
       let dataset = e.target.dataset;
       imageUrl = that.Article_cover;
       title = `${nickName}分享一篇好文给你！`

    }else if(fromPage==='index'&&e.from==='button'){
      // 页面内分享   
      let dataset = e.target.dataset;
      if(dataset.type==='vote'){
        imageUrl = this.vote_poster;
        title = `${nickName}邀请你来投一票`
      }else{
        imageUrl = that.Article_cover;
        title = `${nickName}邀请你一起讨论这个话题`
      }
    }else if(fromPage==='index'&&e.from==='menu'){
        imageUrl = that.Article_cover;
        title = `${nickName}邀请你一起讨论这个话题`
    }

    this.actionSheetHidden = true;
    this.$apply();
    console.log('分享文章id', article_id);

    that.ArticleShare();
    return {
      title: title,
      path: `/pages/details/main?id=${article_id}&share_user_id=${wx.getStorageSync('myid')}&from=${fromPage}`,
      imageUrl: imageUrl,
    };

    
  }

  // input获取焦点
  inputGetFocus() {
    // 这里先设置false再设置true防止本来是true无法获取焦点
    this.inputFcus = false;
    this.$apply();
    this.inputFcus = true;
    this.$apply();
    console.log('输入框获取焦点了', this.inputFcus);
  }

  //   评论文章
  async commentArticle() {
    let that = this;

    wx.navigateTo({
       url:`/pages/inputComment/main?commType=article&article_id=${this.ArticleId}&is_announce=${this.is_announce}`
    })
  }

  // 创建追评
  async commentFollow(user_id, comment_id, fidx, cidx, comment_type) {
    console.log('提交评论', user_id, comment_id, fidx, cidx, comment_type);
    wx.navigateTo({
      url: `/pages/inputComment/main?commType=commentFollow&re_user_id=${user_id}&comment_id=${comment_id}&is_announce=${this.is_announce}&article_id=${this.ArticleId}`
    })
  }

  events = {};

  // 增加文章分享次数
  async ArticleShare() {
    let share = await wxRequest(api.addArticleShareTime, {
      id: this.ArticleId
    });
    console.log('增加分享次数', share);
  }

  // 保存formid
  saveFormId(formId) {
      wxRequest(api.saveFormId,{ formid: formId },'post');
  }

  methods = {
    // 打开肌肤测试
    openSkinTest(){
      wx.navigateToMiniProgram({
        appId: 'wx7a824def006ef999',
        path: 'pages/index/index',
        success(res) {
          // 打开成功
          console.log('打开成功')
        }
      })
    },
    // 页面滚动
    scrollViewScroll(){
      // console.log('页面在滚动');
      if(this.ArticleId!=1924) return;
      let that = this;
      let query = wx.createSelectorQuery();
      query.select('.article-info').boundingClientRect();
      query.exec((res)=>{
        let node = res[0];
        // console.log(node.top)
        if(node.top<600){
          // console.log('该隐藏了')
          that.clickBtnShow = true;
          that.$apply();
        }else{
          that.clickBtnShow = false;
          that.$apply();
        }
      })
    },
    // 书写解忧
    toWriteSolveProblems(){
       wx.navigateTo({url:`/pages/subPackages01/pages/writeSolveProblems/main?article_id=${this.ArticleId}`})
    },
    // 点击打赏图标
    RewardBtn(e){
       if(e){
          let dataset = e.currentTarget.dataset;
          this.RewardUserId = dataset.uid;
          this.currentRewardCommId = dataset.comid;
          this.EditMoney = true;
          let moneyList = this.moneyList;
          moneyList.map(el=>{
             el.active = false;
          });
          this.moneyList = moneyList;
          this.currentRewardMoney = null;
          this.$apply();
       }
       this.showReward = !this.showReward;
       this.$apply();
    },
    // 输入打赏金额
    inputMoney(e){
      console.log(e);
      this.currentRewardMoney = e;
      this.$apply();
    },
    // 点击金额
    changeRewardMoney(e){
       console.log(e)
       this.currentRewardMoney = e;
       this.$apply();
    },
    // 点击切换金额
    TapEditMoney(){
       this.EditMoney = !this.EditMoney;
       if(this.EditMoney===true){
          console.log('当前处于选择金额')
          let moneyList = this.moneyList;
          let aidx = '';
          moneyList.map((el,idx)=>{
            if(el.active===true){
               aidx = idx;
            }
          })
          this.currentRewardMoney = moneyList[aidx].money;
          this.$apply();
       }
       this.$apply();
    },
    // 支付大赏
    async payMoney(){
       console.log('打赏金额', this.currentRewardMoney)
       let that = this;
       let money = this.currentRewardMoney;
       if(!money){
          tips.alert('先选择金额');
          return;
       }
       let json = await wxRequest(api.Raward,{ 
                   rmb: money*100, 
                   to_user:this.RewardUserId, 
                   type:'comment',
                   comment_id: this.currentRewardCommId}, 'POST');

       if(json.data.code===api.STATUS){
          console.log(json)
          let obj = {
            ...json.data.data,
            success(res){
               console.log('支付成功', res)
               that.showReward = false;
               that.$apply();
            },
            fail(res){
              console.log('支付失败', res);
              that.showReward = false;
              that.$apply();
            }
          }
          wx.requestPayment(obj)
       }
    },
    // 切换评论列表
    async changeCommSort(e){
      let dataset = e.currentTarget.dataset;
      let commListNav = this.commListNav;
      commListNav.map(el=>{
        el.active = false;
      });
      commListNav[dataset.idx].active = true;
      wx.setStorage({key:'showCommIndex',data: dataset.idx})
      this.commListNav = commListNav;
      this.$apply();
      console.log(dataset);

      // 请求接口数据
      let json = await wxRequest(api.commentList,{ desc: dataset.type, page:1,id: this.ArticleId});
      console.log('json', json);
      if(json.data.code===api.STATUS){
         let commLs = json.data.data;
         if(dataset.type==='default'){
            this.showNewComm = true;
            this.commTitle = '热门评论'
         }else{
            this.showNewComm = false;
            this.comment = commLs;
            wx.setStorage({key: 'comment', data: commLs})
            this.commTitle = dataset.type==='new'?'按最新排序':'按点亮数排序'
         }
         this.showCommType = dataset.type;
         wx.setStorage({key:'showCommType', data: dataset.type});
         this.page = 2;
         this.$apply();
      }
    },

    // 取消发送
    cencalComment(){
      this.inputShow = false;
      this.commContent = '';
      this.$apply();
    },
    // 评论预览图片
    prevImage(e){
      console.log('预览图片')
      console.log(e.currentTarget.dataset);
      let dataset = e.currentTarget.dataset;
      wx.previewImage({
        current: dataset.arr[dataset.idx], 
        urls: dataset.arr 
      })
    },
    // 已授权点击写评论
    writeComment(){
       this.inputShow = true;
       this.inputFcus =  true;
       wx.navigateTo({
         url: `/pages/inputComment/main?comment_type=文章&article_id=${this.ArticleId}&is_announce=${this.is_announce}`
       });
       wx.setStorage({key: 'commTitle', data: this.ArticleTtictle})
       this.$apply();
    },

    // 点击滚动到评论
    async toComment(){
      console.log('滚动到评论')
      let that = this;
      let position = await utils.getElementRact(`comm`);
      wx.pageScrollTo({
        scrollTop: position[0].top,
        duration: 500
      })
    },

    // 点击投票
    async VoteBtn(){
       // 选项id，文章id
       if(!this.currentVoteId){
         tips.alert('请选择选项');
         return
       }
       let vote = await wxRequest(api.vote,{vote_id:this.currentVoteId, article_id:this.ArticleId});
       if(vote.data.code===api.STATUS){
         this.vote_status = 1;
         let voteList = vote.data.data.list;
         let vote_total_num = vote.data.data.vote_total_num
          voteList.map(el=>{
            el.active = false;
            el.percent = (el.involveNum/vote_total_num*100).toFixed(0);
          })
         this.vote_total = vote_total_num;
         this.voteList = voteList;
         this.$apply();
       }
    },
    // 点击底部导航分享按钮
    shareOpation(){
       let that = this;
       this.actionSheetHidden = !this.actionSheetHidden;
       this.$apply();
    },
    // 选择投票按钮
    changeVote(e){
      let dataset = e.currentTarget.dataset;
      let voteList = this.voteList;
      voteList.map(el=>{
        el.active = false;
      })
      voteList[dataset.idx].active = true;
      this.voteList = voteList;
      this.currentVoteId = dataset.id;
      this.$apply()
    },
    // 下载分享海报
    downloadPoster() {
      utils.getPoster(this.ArticleId);
      this.actionSheetHidden = !this.actionSheetHidden;
      this.$apply();
    },
    // 分享好友
    shareWechat() {},
    //   输入评论
    inputComment(e) {
      // console.log(e.detail.value);
      this.commContent = e.detail.value;
      this.$apply();
    },
    // 返回首页
    goHomego(e) {
       let formId = e.detail.formId;
       this.saveFormId(formId);
       let url = '';
       if(this.fromPage==='news'){
          url = '/pages/news/main'
       }else if(this.fromPage=='index'){
          url = '/pages/index/main'
       }else{
          url = '/pages/index/main'
       }
        wx.switchTab({url});
        wxRequest(api.clickbutton,{type:`${this.fromPage}`},'POST');
    },
    // 文章内部回首页
    ArticleBtnToHome(e){
       wx.switchTab({url:e.currentTarget.dataset.url});
       wxRequest(api.clickbutton,{type:`indextopic`},'POST');
    },
    // input失去焦点
    inputBlur() {
      console.log('失去焦点');
      this.inputFcus = false;
      // this.inputShow = false;
      this.$apply();
    },
    // 点击跟评图标
    followComment(id) {
      this.id = id;
      this.inputGetFocus();
      this.commentDom = 'follow';
      this.$apply();
    },
    // 喜欢文章
    async likeArticle() {
      let that = this;
      const status = this.Article_likestatus == 0 ? 'inc' : 'dec';
      const like = await wxRequest(api.likeArticle, {
        id: this.ArticleId,
        status: status
      });
      if (like.data.code === api.STATUS) {
        this.Article_likestatus = status == 'inc' ? '1' : '0';
        if (status == 'inc') {
          this.Article_liketimes++;
        } else if (status == 'dec') {
          this.Article_liketimes--;
        }
        this.$apply();
      }

      //  点亮文章加经验加积分
      if (like.data.data.getintegral) {
        let toastData = like.data.data.getintegral;
        this.toastTitle = '点亮奖励';
        this.toastJiFen = toastData.integral;
        this.toastJingyan = toastData.empiric;
        this.toastShow = !this.toastShow;
        setTimeout(() => {
          that.toastShow = !that.toastShow;
          that.$apply();
        }, 2000);
        this.$apply();
      }
    },

    // 收起评论
    collapseComment(idx, text) {
      let _comment = [];
      if (text === '收起精彩评论') {
        _comment = this.topComment;
        _comment[idx].follow_comment = _comment[idx].follow_comment.slice(0, 2);
        _comment[idx].is_page = true;
        this.follow_page = 1;
        this.topComment = _comment;
      } else if (text === '收起最新评论') {
        _comment = this.comment;
        _comment[idx].follow_comment = _comment[idx].follow_comment.slice(0, 2);
        _comment[idx].is_page = true;
        this.follow_page = 1;
        this.comment = _comment;
      }
      this.$apply();
    },

    // 点击追评图标
    followCommentComment(id, idx, user_id, type, nickName, comment) {
      console.log('点击一级追评图标', id, idx, user_id, type, nickName);
      this.commentDom = 'follow';
      this.inputGetFocus();
      this.id = id;
      this.commentIdx = idx;
      this.comment_id = id;
      this.user_id = user_id;
      this.comment_type = type;
      this.inputShow = true;
      this.inputPlaceholder = `回复${nickName}`;
      this.$apply();
      
      console.log('名字',`${nickName}`)
      // 跳转
      wx.setStorage({key:'InputTitle', data:`回复${nickName}`});
      wx.setStorage({key:'recomment', data: `${nickName}: ${comment}`})
      wx.setStorage({key: 'commTitle', data: this.ArticleTtictle})
      wx.navigateTo({
        url:`/pages/inputComment/main?commType=follow&commentIdx=${idx}&comment_id=${id}&user_id=${user_id}&comment_type=${type}&is_announce=${this.is_announce}&article_id=${this.ArticleId}`
      })

      

    },
    // 点击二级追评图标
    async followFollowComment(user_id, comment_id, fidx, cidx, type, nickName, comment) {
      console.log(
        '点击二级评论',
        user_id,
        comment_id,
        fidx,
        cidx,
        type,
        nickName
      );
      this.inputGetFocus();
      this.user_id = user_id;
      this.commentDom = 'follow';
      this.comment_id = comment_id;
      this.follow_index = fidx;
      this.commentIdx = cidx;
      this.comment_type = type;
      this.inputPlaceholder = `回复${nickName}`;
      this.$apply();

      // 跳转
      wx.setStorage({key: 'recomment', data: `${nickName}: ${comment}`});
      wx.setStorage({key: 'InputTitle', data:`回复${nickName}`});
      wx.setStorage({key: 'commTitle', data: this.ArticleTtictle})

      wx.navigateTo({
        url: `/pages/inputComment/main?user_id=${user_id}&commType=follow&comment_id=${comment_id}&follow_index=${fidx}&commentIdx=${cidx}&comment_type=${type}&is_announce=${this.is_announce}&article_id=${this.ArticleId}`
      })
    },
    // 提交评论
    async addComment() {
      // console.log('评论发送了', this.commContent);
      if (!this.commContent) return;
      let _data = JSON.stringify({ content: this.commContent });
      console.log('评论对象',this.commentDom)
      if (this.commentDom === 'article') {
        console.log('评论文章');
        this.commentArticle();
      } else if (this.commentDom === 'follow') {
        console.log('追评');
        this.commentFollow(
          this.user_id,
          this.comment_id,
          this.follow_index,
          this.commentIdx,
          this.comment_type
        );
        this.inputFcus = false;
      }
      this.inputFcus = false;
      this.$apply();
    },
    // 点亮
    async likeCommentZan(cidx, id, likestatus, type) {
      console.log('点亮');
      console.log(cidx, id, likestatus, type);
      let that = this;
      this.inputFcus = false;
      let runEnd = true;
      let _status = likestatus == '0' ? 'inc' : 'dec';
      if(runEnd){  
          console.log('_status', _status);
          let comment = null;
          if (type === '最新评论点亮') {
            comment = this.comment;
          } else if (type === '精彩评论点亮') {
            comment = this.topComment;
          }
            //   console.log('comment', comment[cidx])
            if (likestatus) {
              comment[cidx].liketimes--;
              comment[cidx].likestatus = 0;
            } else if (likestatus == '0') {
              comment[cidx].liketimes++;
              comment[cidx].likestatus = 1;
            }

            if (type === '最新评论点亮') {
              this.comment = comment;
            } else if (type === '精彩评论点亮') {
              this.topComment = comment;
            }
          this.$apply();
      }
      let like = await wxRequest(api.likeComment, { comment_id: id,status: _status});
      console.log('点亮结果', like);
      if (like.data.code === api.STATUS) {
        //   点亮加经验加积分
        console.log('点亮数据', like.data.data.getintegral);
        if (like.data.data.getintegral) {
          let toastData = like.data.data.getintegral;
          this.toastTitle = '点亮奖励';
          this.toastJiFen = toastData.integral;
          this.toastJingyan = toastData.empiric;
          this.toastShow = !this.toastShow;
          setTimeout(() => {
            that.toastShow = !that.toastShow;
            that.$apply();
          }, 2000);
          this.$apply();
        }
      }
      this.$apply();
    },

    // 查看更多评论
    async readMoreFollowComm(id, idx, text) {
      console.log('点击更多评论', id, idx, text);
      this.follow_index = idx;
      this.inputFcus = false;
      let page = this.follow_page;
      if (this.follow_id !== id) {
        this.follow_page = 1;
        this.$apply();
      }
      this.follow_id = id;
      this.$apply();
      console.log('点击更多评论');
      let more = await wxRequest(api.followWommentList, {
        comment_id: id,
        page_size: 10,
        page: this.follow_page,
        sort: 'desc'
      });
      if (more.data.code === api.STATUS) {
        let _comment = [];
        // if (page === 1) more.data.data.list.splice(0, 2);  
        if (text === '点击精彩评论查看更多') {
          _comment = this.topComment;
          _comment[idx].follow_comment = [..._comment[idx].follow_comment,...more.data.data.list];
          _comment[idx].is_page = more.data.data.is_page;
          
          // 隐藏查看更多评论
          let _follow_comment = _comment[idx].follow_comment;
          _comment[idx].follow_comment = utils.unique(_follow_comment);
          this.topComment = _comment;
          this.$apply();
        } else if (text === '点击最新评论查看更多') {
          _comment = this.comment;
          _comment[idx].follow_comment = [..._comment[idx].follow_comment,...more.data.data.list];
          _comment[idx].is_page = more.data.data.is_page;

          // 隐藏查看更多评论
          let _follow_comment = _comment[idx].follow_comment;
          _comment[idx].follow_comment = utils.unique(_follow_comment);
          this.comment = _comment;
          this.$apply();
        }
        if (more.data.data.list.length>0) {
          this.follow_page = this.follow_page+1;
          this.$apply();
        }
      }
      this.$apply();
    },
    // 追加评论点亮
    async addFollowZan(status, id, fidx, cidx, type) {
      console.log('追加评论点亮', status, id, fidx, cidx, cidx, type);
      let that = this;
      this.inputFcus = false;
      this.$apply();
      let _status = status == '0' ? 'inc' : 'dec';
      
      let _comment = type === '精彩评论' ? that.topComment : that.comment;
      if (status == '0') {
        _comment[cidx].follow_comment[fidx].liketimes++;
        _comment[cidx].follow_comment[fidx].likestatus = 1;
      } else if (status == '1') {
        _comment[cidx].follow_comment[fidx].liketimes--;
        _comment[cidx].follow_comment[fidx].likestatus = 0;
      }

      if (type === '精彩评论') {
        that.topComment = _comment;
      } else if (type === '最新评论') {
        that.comment = _comment;
      }

      that.$apply();
      
      
      let zan =  await wxRequest(api.likefollowcomment, {follow_comment_id: id,status: _status});
      if (zan.data.code === api.STATUS) {
        
        //    追评点亮加积分加经验
        if (zan.data.data.getintegral) {
          let toastData = zan.data.data.getintegral;
          this.toastTitle = '点亮奖励';
          this.toastJiFen = toastData.integral;
          this.toastJingyan = toastData.empiric;
          this.toastShow = !this.toastShow;
          setTimeout(() => {
            that.toastShow = !that.toastShow;
            that.$apply();
          }, 2000);
          this.$apply();
        }
      }
      this.$apply();
    },
    // 获取用户信息
    async getUserInfo(e) {
      let userInfo = e.detail.userInfo;
      if (!userInfo) return;
      userInfo.is_accredit = 1;
      this.userInfo = userInfo;
      let _userInfo = await wxRequest(api.saveUserInfo, userInfo);
      if (_userInfo.data.code === api.STATUS) {
        this.is_accredit = 1;
        this.inputFcus = true;
        this.inputShow = true;
      }
      this.$apply();
    },

    // 去用户中心
    toUserCenter(user_id) {
      console.log('用户id', user_id);
      let myid = wx.getStorageSync('myid');
      if (user_id!=myid) {
        wx.navigateTo({
          url: `/pages/subPackages01/pages/otherUserCenter/main?user_id=${user_id}`
        });
      }
    }
  }

  async onReachBottom(){
      console.log('触底了');
      let showCommType = this.showCommType;
      let more = await wxRequest(api.commentList, {
        page: this.page,
        id: this.ArticleId,
        desc: showCommType
      });
      console.log('more', more);
      if (more.data.code === api.STATUS) {
        if (more.data.data.length > 0) {
          let oldList = this.comment;
          let comment = [...oldList, ...more.data.data];
          this.comment = utils.commentUnique(comment);
          wx.setStorage({key: 'comment', data:this.comment});
          this.page++;
          this.$apply();
        }
      }
  }
}
</script>

<style lang="less">
.loading {
  width: 100%;
  height: 100%;
  position: fixed;
  left: 0;
  top: 0;
  background: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 90000;
  image {
    width: 100rpx;
  }
}

page {
  background-color: #eeeeee;
}

.detail{
  background: #fff;
}

.topic_title {
  padding: 40rpx 0 40rpx 0;
  box-sizing: border-box;
  position: relative;
  text-align: left;
  font-size: 36rpx;
  font-weight: bold;
  width: 680rpx;
  margin: 0 auto;
}

.author {
  width: 680rpx;
  margin: 0 auto 70rpx auto;
  font-size: 28rpx;
  .applet {
    color: #7c48c6;
    display: inline-block;
    margin-right: 30rpx;
  }
  .create_time {
    color: #999;
  }
  .orgin_author{
    display: inline-block;
    color: #999;
    margin-right: 30rpx;
  }
}

.zan {
  align-items: center;
  margin-right: 40rpx;
  display: flex;
  align-items: center;
  font-size: 28rpx;
}

.comments {
  background-color: #ffffff;
  margin-bottom: 20rpx;
}
 
.topic{
   border-bottom: 20rpx solid #f7f7f7;
   padding-bottom: 40rpx;
 }

.topic_img {
  display: block;
  width: 100%;
}

.wonderfulComments {
  font-size: 30rpx;
  font-weight: bold;
  color: #333333;
  padding: 30rpx 35rpx;
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  text {
    display: inline-block;
  }
  .wrtie-comment {
    font-size: 20rpx;
    font-weight: normal;
    color: #999;
    display: inline-block;
    position: relative;
    display: flex;
  }
  .ls-item{
    padding: 0 15rpx;
    position: relative;
  }
  .ls-item:not(:last-child)::after{
    content: '|';
    display: block;
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    color: #eee;
  }
  .ls-active{
    color: #7c48c6;
  }
}
.commentsConter {
  padding: 30rpx;
  border-top: 1rpx solid #e5e5e5;
}

.comm_main{
  display: flex;
}

.active_comment{
  animation: linearBg 1s forwards;
  transition: 1s;
}

@keyframes linearBg {
   0%,60%,80%{
     background: #fff;
   }
   20%,40%,100%{
     background: #fff3e3;
   }
}

.head_img {
  width: 80rpx;
  height: 80rpx;
  border-radius: 50%;
  flex-shrink: 0;
}

.avatar{
  margin-right: 20rpx;
}

.head-reward{
  width: 50rpx;
  height: 50rpx;
  border:1px solid #ffb85b;
  color: #ffb85b;
  text-align: center;
  border-radius: 50%;
  margin: 10rpx auto 0 auto;
  display: flex;
  justify-content: center;
  align-items: center;
}

.display_flex {
  display: flex;
  align-items: center;
}

.verticalBar {
  width: 4rpx;
  background-color: #999999;
  margin-left: 20rpx;
  margin-right: 20rpx;
  height: 20rpx;
}
.floor {
  color: #999999;
  font-size: 20rpx;
  margin-top: 10rpx;
}
.nice {
  font-size: 28rpx;
  color: #999999;
  line-height: 56rpx;
  margin-right: 40rpx;
  display: flex;
  align-items: center;
}

.niceImg,.zan_get_info{
  width: 50rpx;
  height: 50rpx;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAoCAMAAABevo0zAAABC1BMVEUAAACZmZmYmJiampqZmZmXl5eZmZmZmZmZmZn/7QD/0QD/3QCZmZmZmZmZmZmZmZn/5QD+5wD98QCZmZn/yACZmZn/ywCZmZn/3wD/0wD/2gCZmZn/4wCZmZmZmZmZmZn/zgCZmZn/yACYmJiZmZn+5gD/zAD97QD/zgCampr/zAD/7gCbm5v/2wCZmZn/zwD+5gD+5wD+5gD/xAD+5wD98QD/3ACZmZn/3wCYmJj/6gD/xgD/8AD/zQD/7AD/2QD+5AD/0gD+7AD/zgD/ywD+2gD/wQD92wCampr98gD/5wCZmZn/1gD+3wD/zwD+5QD+6QD+3AD+2QD+7QD/0gD+4gD/zAD+8gD/wwCCGnC3AAAAS3RSTlMAQDUTqA2dU0lCNRH6y60oDfqpg316aGZUSSkdFevh19LRzr60sK+dm4qEHAkJ8vLs4NfIvaeKa2daWlJGPzoh6eHNwLerqJqXiHXi5ALXAAAB00lEQVRIx+3UWVPiQBSG4S+JJCSBAMMqi4AgmzCjjtu4zr6dkeCo6P//JWajQmza9JU3+twAVam3TvUJjTev0CcK1PCsk/vAdkwwo655hgk8q9o/eOc4+JPFS0tISUlKyoiT1c90/ewivrdBHjXmOXP3xtNHjBr50jHPbd/4voJHkvxgyg924GN2o+t+MDfz7C8mZoJEquJ2ydeAS2um8MRs1q+73ZlvB67KXo4JdohSTrFLgaIzneV84ol92845xS078BfIuj/AKDcaSvheU6oGhcjKMM8df94xcWIv5C5Rt+2t6qoFjyFTqAnIyZUvzATGXWgPuFgHxwYtyYNr92rJIbg0CnlHylG5WnZtgkelCA0cv64jKuCxKOIIHD/+RxyDZyg44eG/CP6ESYrgnuF6NFgHhLasguvL7ZIB72rtthWZQu8T42IZrGqvZRrT0IfspFACK+80ZJTDngyJqMNcjCOnYaAU9gycT6ffjBWXQ1Nzj7Ht97oZQFFX/Jfn89ape4ytuef7JWAOnC9M8Hd+sZmhZRWDwaQ0cy8ORovNjHq9QjDY+eYmXtC4nIGISakKIUeUhojSw0cIKQoGC6LBPLUFg4Kb0GgNIk4ffuLN6/QIco6VWhMTc3UAAAAASUVORK5CYII=');
  background-size: 100rpx 50rpx;
  background-repeat: no-repeat;
  background-position: 0 0;
  background-clip: content-box;
  background-color: transparent;
  border-radius: 0;
}

.active_nice{
  width: 50rpx;
  height: 50rpx;
  // padding: 8rpx;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAoCAMAAABevo0zAAABC1BMVEUAAACZmZmYmJiampqZmZmXl5eZmZmZmZmZmZn/7QD/0QD/3QCZmZmZmZmZmZmZmZn/5QD+5wD98QCZmZn/yACZmZn/ywCZmZn/3wD/0wD/2gCZmZn/4wCZmZmZmZmZmZn/zgCZmZn/yACYmJiZmZn+5gD/zAD97QD/zgCampr/zAD/7gCbm5v/2wCZmZn/zwD+5gD+5wD+5gD/xAD+5wD98QD/3ACZmZn/3wCYmJj/6gD/xgD/8AD/zQD/7AD/2QD+5AD/0gD+7AD/zgD/ywD+2gD/wQD92wCampr98gD/5wCZmZn/1gD+3wD/zwD+5QD+6QD+3AD+2QD+7QD/0gD+4gD/zAD+8gD/wwCCGnC3AAAAS3RSTlMAQDUTqA2dU0lCNRH6y60oDfqpg316aGZUSSkdFevh19LRzr60sK+dm4qEHAkJ8vLs4NfIvaeKa2daWlJGPzoh6eHNwLerqJqXiHXi5ALXAAAB00lEQVRIx+3UWVPiQBSG4S+JJCSBAMMqi4AgmzCjjtu4zr6dkeCo6P//JWajQmza9JU3+twAVam3TvUJjTev0CcK1PCsk/vAdkwwo655hgk8q9o/eOc4+JPFS0tISUlKyoiT1c90/ewivrdBHjXmOXP3xtNHjBr50jHPbd/4voJHkvxgyg924GN2o+t+MDfz7C8mZoJEquJ2ydeAS2um8MRs1q+73ZlvB67KXo4JdohSTrFLgaIzneV84ol92845xS078BfIuj/AKDcaSvheU6oGhcjKMM8df94xcWIv5C5Rt+2t6qoFjyFTqAnIyZUvzATGXWgPuFgHxwYtyYNr92rJIbg0CnlHylG5WnZtgkelCA0cv64jKuCxKOIIHD/+RxyDZyg44eG/CP6ESYrgnuF6NFgHhLasguvL7ZIB72rtthWZQu8T42IZrGqvZRrT0IfspFACK+80ZJTDngyJqMNcjCOnYaAU9gycT6ffjBWXQ1Nzj7Ht97oZQFFX/Jfn89ape4ytuef7JWAOnC9M8Hd+sZmhZRWDwaQ0cy8ORovNjHq9QjDY+eYmXtC4nIGISakKIUeUhojSw0cIKQoGC6LBPLUFg4Kb0GgNIk4ffuLN6/QIco6VWhMTc3UAAAAASUVORK5CYII=');
  background-size: 100rpx 50rpx;
  background-repeat: no-repeat;
  background-clip: content-box;
  background-position:-50rpx 0;
  border-radius: 0;
}

.same-comm{
   width: 50rpx;
   height: 50rpx;
   padding: 0;
   margin: 0;
   background-color: transparent;
   border-radius: 0;
   background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAMAAAApWqozAAAATlBMVEUAAACZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZlpQKrPAAAAGXRSTlMA+e+Ce/Tq2JYb4tKghkg9IhOtq3RmkFQPQH5XKwAAAJhJREFUOMvtk0kOgzAMRX+cqSEMCdCB+1+0UhFZtI5cVUJdwFt58WR9WzZOjouJVr3TTAEcl4WFEuMOS4WWkbuaTIysa7IVZLGz2Uvu/ddyLkt2+qbWapo9K19t6dNvo45AcKxMm6sycH9VHQDPxniUGG1Icc0zZCMOSCVS84c9Q+9wSMKJut+OX34rl8AxR/p82DHg5Ig8AZluLwYMjkMxAAAAAElFTkSuQmCC');
   background-size: 50rpx 50rpx;
   background-repeat: no-repeat;
   background-position: center;
   margin-right: 4rpx;
}

.like_times{
    min-width: 20rpx;
}

.commentTalk {
  width: 42rpx;
  height: 30rpx;
}
.comment_name {
  color: #333333;
  font-size: 28rpx;
  overflow: hidden;
  max-width: 250rpx;
  text-overflow: ellipsis;
  white-space: nowrap;
  // border:1px solid red;
}

.lv-icon {
  margin-left: 10rpx;
  display: inline-block;
  image {
    display: inline-block;
    width: 28rpx;
    height: 28rpx;
    margin: 0 2rpx;
  }
}

.flex_end {
  align-self: flex-end;
}

// 一级评论图片
.comm-image{
  display: flex;
  flex-wrap: wrap;
  padding-left: 98rpx;
  margin-bottom: 30rpx;
  .c-image{
    width: 150rpx;
    height: 150rpx;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    margin:6rpx;
    flex-wrap: wrap;
    image{
      display: block;
      width: 150rpx;
      height: 150rpx;
    }
  }
}

// 二级评论图片
.f-image{
  display: flex;
  flex-wrap: wrap;
  .f-img{
    width: 150rpx;
    height: 150rpx;
    background-color: #eee;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 6rpx;
    flex-wrap: wrap;
    overflow: hidden;
    image{
      display: block;
      width: 150rpx;
      height: 150rpx;
    }
  }
}

.commentsTxt {
  color: #333333;
  font-size: 28rpx;
  margin: -14rpx 13rpx 30rpx 97rpx;
  padding: 0;
  background: transparent;
  text-align: justify;
  text-indent: 0;
  line-height: 40rpx;
}

.font_24 {
  color: #666666;
  font-size: 24rpx;
  margin-bottom: 24rpx;
}

.content {
  width: 680rpx;
  margin: 0 auto;
  min-height: 100vh;
  margin-bottom: 80rpx;
}

.richtext {
  width: 680rpx;
  display: block;
  margin: 0 auto;
  .common-css {
    padding: 0;
    margin: 0;
    font-family: 'Microsoft YaHei';
    box-sizing: border-box;
  }
  .p {
    color: #444;
    font-size: 32rpx;
    line-height: 1.6 !important;
    margin: 15rpx 0;
    margin: 0 atuo;
    width:100%;
    font-weight: 300;
    text-align: justify;
    box-sizing: border-box;
  }
  .common-css::after,
  .common-css::before {
    content: '';
    visibility: hidden;
  }
  .page {
    position: relative;
    width: 750rpx;
    min-height: 100%;
    font-family: 'SimHei';
    background-color: #fff;
  }
  .page-rich-text {
    width: 100%;
  }
  .div {
    margin-bottom: 20rpx;
    width: 100%;
    font-size: 30rpx;
    color: #454545;
    line-height: 66rpx;
    text-indent: 2rem;
    letter-spacing: 4rpx;
    word-spacing: 4rpx;
  }
  .img {
    max-width: 680rpx;
    margin: 0;
    padding: 0;
    display: block;
    // border:1px solid red;
    // position: relative;
    // left: 50%;
    // transform: translateX(-50%);
  }
  .em {
    font-size: 26rpx;
    color: #868686;
  }
  .a,
  .span {
    font-size: 30rpx;
    color: #333;
  }
  .page-share {
    display: none;
    position: fixed;
    top: 10rpx;
    left: 10rpx;
    z-index: 99;
    width: 200rpx;
    height: 60rpx;
    background-color: #226abc;
  }
}

// 跟评样式
.comm_comment {
  margin-right: 20rpx;
  height: 50rpx;
  display: flex;
  align-items: center;
}

.com_comments {
  background-color: #f7f7f7;
  padding: 24rpx 20rpx 20rpx 20rpx;
  margin-left: 78rpx;
  .info-left {
    display: flex;
    padding-bottom: 10rpx;
    position: relative;
  }
  .border_bottom {
    position: relative;
    padding-bottom: 10rpx;
  }
  .border_bottom:after {
    content: '';
    display: block;
    width: 100%;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    transform: scaleY(0.5);
    left: 0;
    bottom: 0;
    position: absolute;
  }
  .last-noborder:nth-last-of-type(1):after {
    display: none;
  }
  .info-avatar {
    width: 50rpx;
    height: 50rpx;
    margin-right: 14rpx;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .info-name {
    font-size: 24rpx;
    color: #793292;
  }
  .info-time {
    font-size: 22rpx;
    color: #8c8c8c;
  }
  .talker {
    text-align: justify;
    line-height: 40rpx;
    font-size: 28rpx;
    text {
      color: #793292;
    }
  }
  .otherAnswer {
    font-size: 24rpx;
    color: #5eb6e7;
    text-align: center;
  }
  .user-info {
    display: flex;
    justify-content: space-between;
  }
  .info-comm-btn {
    display: flex;
    height: 50rpx;
    align-items: center;
    box-sizing: border-box;
  }
}

// 暂无评论
.no-comment {
  width: 750rpx;
  height: 300rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  background-color: #f9f9f9;
  color: #888;
  margin-top: -30rpx;
  image {
    display: block;
    width: 100rpx;
    height: 100rpx;
    margin-bottom: 20rpx;
  }
}

// 输入框
.input-view {
  position: fixed;
  left: 0;
  bottom: 0rpx;
  width: 750rpx;
  min-height: 100rpx;
  background: #fff;
  display: flex;
  justify-content: center;
  box-sizing: border-box;
  padding: 10rpx 20rpx;
  box-shadow: 0 -5rpx 20rpx rgba(0, 0, 0, 0.1);
  .add-image{
    width: 52rpx;
    height: 52rpx;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAAzCAMAAADvo9thAAAAe1BMVEUAAABkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGSYekhrAAAAKHRSTlMA+ecG3BarU4FJ3+vkxlscCIpXPzgKdxHX0b2lnYTvlHAuKCThZEsOGa9+5gAAAXxJREFUSMfdldtygjAURRNCCCICooJa7/ay//8LS0wdiBDC6Utnul7IMCyyc3Jjk5kFwYxRCYCALKHh30uifEs4Blg9ag2Ln8qrEA5uptYvlu5mCSe5SxpxUAzES5t4pW7wg7rXYnIhRApgl9OqlzXtuSSWPGraR+o8JXo2qJKeU0ndGu0PijjkYVy4N2E660mbBTSLDSVqDENMkZ7rL6RIHAb+m54SNsimzq996egcU/sdtXqtNDpPfqnlD6RK0aUMc0mVVhyIiNL6hAZFku5zNOiAfqn8ME/5XFORX8pPfK2fXws8UV5pD6Q5Y2JvBBPQI10ea0+wN3SIxqUrh+ZwhIUak8QOFm3AYUkyxz3QBhQ9SZds5XJMQGlJeiAXxup3txRI80/OusfynpmKjQSsrNMjMvl8bK3lkWlpW3ucGA0Zsy417G6jTqVHnor2RQlzf37mgg1QyHW1habsvl5iEkvWRZynOOfXHCr0KaFiPUQWJdwl8CTK7G6+AXXtiLa+XMiwAAAAAElFTkSuQmCC');
    background-size: 100% 100%;
    margin:10rpx 0 0 16rpx;
  }
}

.botm-bar{
  display: flex;
  position: fixed;
  left: 0;
  bottom: 0;
  width: 100%;
  height: 160rpx;
  background: #fff;
  padding: 20rpx 30rpx 30rpx 30rpx;
  align-items: center;
  box-shadow: 0 0 10rpx rgba(0, 0, 0, 0.1);
  z-index: 100;
  .is_userinfo{
    width: 360rpx;
    height: 68rpx;
    border-radius: 40rpx;
    background: #eee;
  }
  .btn-input{
    width: 100%;
    height: 100%;
    border-radius: 50rpx;
    text-align: left;
    line-height: 88rpx !important;
    padding: 0 0 0 20rpx;
    margin:0;
    display: flex;
    align-items: center;
    color: #999;
    flex-shrink: 0;
    font-size: 28rpx;
  }
  .input-op{
    flex: 1;
    display: flex;
    justify-content: space-around;
    padding-left: 30rpx;
    .a-op{
      width: 88rpx;
      height: 88rpx;
      display: flex;
      flex-direction: column;
      justify-content: center;
      // border:1px solid #f3f;
    }
    .a-icon{
      width: 50rpx;
      height: 50rpx;
      margin: 0 auto;
      // background: #f3f;
    }
    .share{
      background-image: url('http://p766oymet.bkt.clouddn.com/nvzhu/comm_sprites.png');
      background-size: 100rpx 100rpx;
      background-position: 0 -50rpx;
    }
    .like{
      background-image: url('http://p766oymet.bkt.clouddn.com/nvzhu/comm_sprites.png');
      background-size: 100rpx 100rpx;
      background-position: 0 0;
    }
    .like-active{
      background-image: url('http://p766oymet.bkt.clouddn.com/nvzhu/comm_sprites.png');
      background-size: 100rpx 100rpx;
      background-position: -50rpx 0;
    }
    .comm{
      background-image: url('http://p766oymet.bkt.clouddn.com/nvzhu/comm_sprites.png');
      background-size: 100rpx 100rpx;
      background-position: -50rpx -50rpx;
    }
    .num{
      font-size: 20rpx;
      color: #999;
      text-align: center;
      line-height: 1;
    }
  }
}

.action-item{
  width: 750rpx;
  height: 90rpx;
  border-radius: 0;
  background: #fff;
}
.action-item0{
  border-bottom: 1px solid #eee;
}

// 分享
.article-info {
  width: 680rpx;
  margin: 0 auto;
  display: flex;
  justify-content:space-between;
  .info-item {
    min-width: 150rpx;
    display: flex;
    align-items: center;
    position: relative;
    color: #999;
    font-size: 28rpx;
  }
  .comment{
    color: #333;
    font-size: 24rpx;
    display: flex;
    align-items: center;
    margin-left: 40rpx;
    button{
      display: inline-block;
      padding: 0 10rpx;
      margin: 0;
      font-size: 24rpx;
      background: #ff9800;
      color: #fff;
      border-radius: 4rpx;
      height: 40rpx;
      line-height: 40rpx;
      margin-left: 10rpx;
      box-shadow: 0 0 6rpx rgba(0,0,0,.5);
    }
  }
  text{
    display: inline-block;
    margin-right: 10rpx;
  }
}

.flex_wrap {
  flex-wrap: wrap;
}

.get_user_info{
   padding: 0;
   margin: 0;
}

// 投票
.vote{
  width: 630rpx;
  min-height: 635rpx;
  background-color: #e8ecff;
  border: 1px solid #49017e;
  background-size: 100% 100%;
  padding: 30rpx 20rpx 0 0;
  position: relative;
  left: 50%;
  margin: 0 auto 200rpx -280rpx;
  .vote_title{
    font-size: 34rpx;
    font-weight: bolder;
    padding-bottom: 60rpx;
  }
  .vote-in{
    width: 630rpx;
    min-height: 635rpx;
    margin-left: -30rpx;
    position: absolute;
    left: 0;
    top: 30rpx;
    padding:30rpx 30rpx 60rpx 30rpx;
    background-color: #fff;
    border: 1px solid #49017e;
    overflow: hidden;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeAQMAAAAB/jzhAAAABlBMVEX////u7u5x8T/JAAAAEklEQVQI12MAApZBRfz///8PACz5BG7bxJ08AAAAAElFTkSuQmCC');
    background-size: 30rpx 30rpx;
  }
  .info{
    display: flex;
    justify-content: space-between;
    font-size: 24rpx;
    color: #666;
    margin-bottom: 50rpx;
  }
  .player{
    display: flex;
    text{
      color: #f8814a;
    }
  }
  .remain{
    display: flex;
    justify-content: flex-end;
    .time{
      color: #f15969;
      min-width: 170rpx;
      text-align: right;
    }
  }
  .item{
    width: 520rpx;
    height: 88rpx;
    text-align: left;
    display: flex;
    align-items: center;
    margin-bottom: 30rpx;
    padding-left: 20rpx;
    border-radius: 10rpx;
    position: relative;
    // border:1px solid red;
  }

  .vote-item{
    display: flex;
    align-items: center;
    position: relative;
    .circle{
      width: 30rpx;
      height: 30rpx;
      border-radius: 50%;
      position: relative;
      margin-right: 20rpx;
      transform: translateY(-15rpx);
      border:1px solid transparent;
    }
    .item{
      border:1px solid transparent;
    }
  }
  .vote-item:nth-of-type(odd) .circle,
  .vote-item:nth-of-type(odd) .circle
  {
    border-color: #f04759;
  }
  .vote-item:nth-of-type(even) .circle{
    border-color: #4cbef1;
  }
  .vote-item:nth-of-type(even) .item{
    border-color: #4cbef1;
  }
  .vote-item:nth-of-type(odd) .item{
    border-color: #f04759;
  }
  .vote-item:nth-of-type(odd) .circle-active,
  .vote-item:nth-of-type(odd) .text-active{
     background: #f04759;
     color: #fff;
  }
  .vote-item:nth-of-type(even) .circle-active,
  .vote-item:nth-of-type(even) .text-active{
     background: #4cbef1;
     color: #fff;
  }

  .vote-after{
    .v-title{
       margin-bottom: 20rpx;
       display: flex;
       align-items: center;
    }
    .v-item:nth-of-type(odd) .v-title:before{
      content: '';
      display: block;
      width: 30rpx;
      height: 30rpx;
      margin-right: 20rpx;
      border-radius: 50%;
      background: #f04759;
    }
    .v-item:nth-of-type(even) .v-title:before{
      content: '';
      display: block;
      width: 30rpx;
      height: 30rpx;
      margin-right: 20rpx;
      border-radius: 50%;
      background: #4cbef1;
    }
    .v-vote-bar{
      width: 536rpx;
      height: 48rpx;
      background: #f5f4f7;
      border-radius: 30rpx;
      margin:0 0 40rpx 30rpx;
      display: flex;
      justify-content: space-between;
      position: relative;
      text{
        display: inline-block;
        font-size: 28rpx;
        position: absolute;
        right: 10rpx;
        top: 50%;
        transform: translateY(-50%);
      }
    }
    .bar-in{
      border-radius: 30rpx;
      font-size: 26rpx;
      line-height: 48rpx;
      height: 48rpx;
      color: #fff;
      text-indent: 20rpx;
    }
    .v-item:nth-of-type(odd) .bar-in{
      background: #f04759;
    }
    .v-item:nth-of-type(even) .bar-in{
      background: #4cbef1;
    }
    .invate-btn{
      width: 379rpx;
      height: 118rpx;
      background-image: url(http://p766oymet.bkt.clouddn.com/nvzhu/vote-bth-bgc.png);
      background-size: 100% 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      font-size: 30rpx;
      background-color: transparent;
    }
  }
  .vote-btn{
      width: 379rpx;
      height: 118rpx;
      background-image: url(http://p766oymet.bkt.clouddn.com/nvzhu/vote-bth-bgc.png);
      background-size: 100% 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      font-size: 30rpx;
      background-color: transparent;
    }

}
.vote::before{
  content: '';
  display: block;
  width: 128rpx;
  height: 48rpx;
  background-image: url('http://p766oymet.bkt.clouddn.com/nvzhu/vote-text-icon.png');
  background-size: 100% 100%;
  position: absolute;
  left: -38rpx;
  top: -2rpx;
  z-index: 2;
}

// 解忧栏目
.solve-problems{
  width: 680rpx;
  overflow: hidden;
  background: #fff;
  position: relative;
  padding-top: 20rpx;
  margin: 0 auto 40rpx auto;
  .write-email{
    background-color: transparent;
    width: 700rpx;
    height: 310rpx;
    padding: 220rpx 0 0 0;
    margin: 0 auto;
    color: #fff;
    font-size: 24rpx;
    position: relative;
    transform: translateX(-50%);
    left: 50%;
    background-image: url('https://gcdn.playonwechat.com/nvzhu/repack/letter.png');
    background-size: 100% 100%;
  }
  .solve-btn{
    width: 112rpx;
    height: 46rpx;
    position: absolute;
    left:50%;
    margin-left: -66rpx;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAAAuCAMAAADHum3+AAAAn1BMVEUAAAA0bQE0bQE0bQE0bQE0bQE0bQE0bQE0bQE0bQFtsi9apTxiqzY0bQH+/v5eqDlpsDFlrTRnrjPC3LOmzYru9eqcxY+917Xt9OuhyY2cyHtGhRG62KWkzItdoy9mqSlBgRPm8ODL4b7H3cCOwWxur016uEbc6tW006h3smJPkyZZmyBLjR5UlBv2+fTT5cuFvVqoy5yu0JmRv4FUnTPlNoxxAAAACnRSTlMA4lT4qwbaiVuUFCaGOgAABFBJREFUWMO9mGlz2jAQhoFAmi5r7a5sEgKEK1ebo+n1/39bpbUOOwZnJjP0+QDMIOnRvpIF9kCZjMbDs+KEnJ2PR5NBYnRebJ/W6GCQqYMIiYSmhAyA0yYkgooVUupu7AAA/Y6mHf4+bYvzUfR9KbZr7SccR3e9XD8LjnZ3ZMEgEtfWvzrCJMSJJRi7zm3xJfpeBP3MGUDiuIJ1fUzv6gMARj+9MBXCRFZOD/JSG0fFi86J/VDTgPbxZbR9mp7DJ1r7QpEZndFhI70ULtXJcCvWixA4l0NxfB9gylDE1QZqJLB5Gi10StS1kbW4HU4GF8UmJIlC7xvpdhDLbB3+1TltXSNQs/BOrs1ByCGay7q4GIyXMUnqBqFLxX7WGXRKRyqwayQMWaX9EMeR7XgwfGZLx4SWMRQJHuuXDlQr2BLaVoVi20aPgPc+DQdna+yImgORukQA6sSJazW1sodkFJ+9z68Zqse3oPXZoOheNu2moAilVgy2c61xKFzfwMGNBiQ57GJQSL/QgmLd51ih9m/HIhBgyzF9Svsz+VTY49PrLgnZjeaHQ+oKER6CL4itjk/e1hR4IfcWKBCFU4rhYha+/brX9287s+CGr7GmwZeF9oCIkvCxDFxdXZXKIyq6hb4bc6stfxnzhn63RDj5WqOSj7QrjJNy7U0XDPjCzI/QZXf7W8+7BAayT6d4UIhCcXexMZVyc+lx71GojR7N7aWZB2az+Xw3a5eY89RaVXjo4sN0zhgDsKgewmFkQZww4hO9uzQtkrC9l/1BTEeE1qcRT1IVzsw+CAmwLDFxZcz0PlyIahB4eLeK9Uma3F0hWeCQhG7RqvLCVVVdKtX1ffbd/3DC6Z8rT1mzgIzkX6vjQgoNKRTo8MIGmCmNF7YyraBBFAILodBRIXrSIaPC0hEKyb5ro8LvWvpNde35CQ04jqFFdoR5LcIpxBAwBhzWVw2tQMt+IVhMg8gxIbLDiuhFnIXhPBbAzLed+8Yei1RBiqMcrZDy5dsQzhLzefSR3Pmp2D+3edPcLqAFS/zQK9Q0MwvTAiNc1y71UrDOATp8LFSgwUOzYxZyCPvnPle4vzsmlA+Enal2hWl1TYPPVpgXe78vE48ruDPzVGAWVtdul97cVMeFcFQo7E8oib72RV9CFYUWklBfov8Ycuxog3esfleJVQWrWkgILaGnX8h4+PBG6OfNlCnQ7hr2Cn2J3d9D7pEtVuXOmG/Jl4WzQI8QhCT84nPrKO1hZRz7pm/RjbS3RCJxQqD+AjO7Wblg9UXhbAZw514CVfXQYyR0OGHznsnCRzA53+ewtfBsA5z/hX4sFIbPYgndX/3z53gcojjhSbH4NNTbNcB4xMBp4eU43JAS4f8QbooLd8u9zH/MBU7LcjjxDxVegdOJfFJei5E+NvFG+g/C1/ig5mux3PDJE90si6+NR1/L5zWdsMDN89I/+kpMLk79cG84vpio6h+t7PegIf3+6AAAAABJRU5ErkJggg==');
    background-size: 100% 100%;
    animation: shan 2s linear infinite;
    transition: 1.5s;
  }
  @keyframes shan {
    0%,100%{
      opacity: .9;
    }
    50%{
      opacity: .2;
    }
  }
}

.click-test{
  width: 237rpx;
  height: 132rpx;
  background-image: url('https://gcdn.playonwechat.com/nvzhu/click-btn.png');
  background-size: 100% 100%;
  position: fixed;
  right: -50rpx;
  top: 500rpx;
  transition: 1s;
}

.articl-test{
  width: 352rpx;
  height: 78rpx;
  background-image: url('https://gcdn.playonwechat.com/nvzhu/article-test.png');
  background-size: 100% 100%;
  margin: 0 auto 50rpx auto;
  position: relative;
}

.click-show{
  animation: fadeOut 1s forwards;
}

@keyframes fadeOut {
  0%{
    transform: translateX(-5%);
  }
  100%{
    transform: translateX(200%);
  }
}

.click-hide{
  animation: btnfadeOut 1s forwards;
}

@keyframes btnfadeOut {
  0%{
    transform: translateX(200%);
  }
  100%{
    transform: translateX(-5%);
  }
}




</style>

